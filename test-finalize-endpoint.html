<!DOCTYPE html>
<html>
<head>
    <title>Test Finalize Endpoint</title>
</head>
<body>
    <h1>Test Finalize Endpoint</h1>
    <button onclick="testViaGateway()">Test via Gateway (8585)</button>
    <button onclick="testDirect()">Test Direct (malaka-internal port)</button>
    <div id="result"></div>

    <script>
        const token = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiI0MzcyZjJlZC1iMmU0LTRmOTYtOWMyNS1jNzIwYjQzODVlZmEiLCJpYXQiOjE3NjE4MDYxODQsImV4cCI6MTc2MTgwOTc4NH0.-5NeL3IRLv4fTolx--xOoYHvyunRESQi_7iv1GLbGqQ';
        const topicId = '559020ec-6786-43aa-a3c8-b440d9906e23';
        const uploadId = '4dea4557-26f3-4266-8670-164a821759a5'; // Replace with your upload ID

        async function testViaGateway() {
            await testEndpoint('http://localhost:8585/api/topic', 'Via Gateway');
        }

        async function testDirect() {
            await testEndpoint('http://localhost:8081/api/topic', 'Direct to malaka-internal');
        }

        async function testEndpoint(baseUrl, label) {
            const url = `${baseUrl}/${topicId}/content/chunk/finalize/${uploadId}`;
            console.log(`Testing ${label}: ${url}`);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });

                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <h3>${label} Result:</h3>
                    <p>Status: ${response.status} ${response.statusText}</p>
                    <p>Response: ${await response.text()}</p>
                `;

                console.log(`${label} Status:`, response.status);
                console.log(`${label} Headers:`, [...response.headers.entries()]);
            } catch (error) {
                console.error(`${label} Error:`, error);
                document.getElementById('result').innerHTML = `<h3>${label} Error:</h3><p>${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
